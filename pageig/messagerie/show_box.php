<?phprequire_once($server.'class/message.class.php');if(empty($_GET['tri'])) $_GET['tri'] = 1;if(empty($_GET['min'])) $_GET['min'] = 0;if(empty($_GET['max'])) $_GET['max'] = 10;if(empty($_GET['do'])) $_GET['do'] = '';if($_GET['do'] == 'del'){    $array_mess = $_POST['mess'];    foreach($array_mess as $message_id)    {            $message = new message($message_id);            $message->delete($char);    }}$onclick = "checkAll(document.forms['box_messages_form'].elements['mess[]'])";?><div style="margin-top:5px;margin-left:20px;"><!-- Gestion des mails 	--><div style="margin-top:10px;margin-right:20px;">    <form id="box_messages_form" method="POST">        <table style="width:100%;" border="0" class="backgroundBodyNoRadius" cellspacing="0">            <tr style="font-weight:700;" class="backgroundMenuNoRadius">                <td style="width:20px;text-align:center;"><input type="checkbox" onclick="'.$onclick.'" /></td>                <td style="width:20px;text-align:center;">lu</td>                <td style="padding-left:10px;"> Exp&eacute;diteur</td>                <td style="width:50%;padding-left:10px;"> Titre </td>		                <td style="width:25%;padding-left:10px;"> Date </td>	            </tr><?php		$allmessage = message::getAllMessage($char,$_GET['tri'],$_GET['min'],$_GET['max']);if(count($allmessage)>= 1){    foreach($allmessage as $message_values)    {        $message = new message($message_values);        ?>        <tr style="color:#FFFFFF;">            <td> <input value="'.$message_id.'" type="checkbox" name="mess[]" /></td>        <td>                <?php if($message->isread($char)){ ?>                    <img src="pictures/utils/read.gif" alt="lu" />                <?php }else{ ?>                    <img src="pictures/utils/noread.gif" alt="non lu" />                <?php }?>            </td>        <td style="text-align:center;">            <?php echo char::getNameById($message->getFrom()); ?>        </td>                <td style="padding-left:25px;">            <a href="#" style="text-decoration:none;color:#FFFFFF;" onclick="viewMessage('<?php echo $message->getId(); ?>');"><?php echo $message->getTitle() ?> </a>        </td>        <td>            <?php getDateText($message->getTime(),'classic','yes'); ?>        </td>    </tr>    <tr id="view_mess_<?php echo $message->getId();?>_container" style="display:none;">        <td colspan="5"><div id="view_mess_<?php echo $message->getId(); ?>"></div></td>    </tr><!-- Ici le d�tail en cach�--><?php    }}else{    if($_GET['tri'] == 1)        echo '<tr><td colspan="5" style="font-weight:700;">Vous n\'avez pas de nouveaux messages</td></tr>';    else{        echo '<tr><td colspan="5" style="font-weight:700;">';        switch($_GET['tri'])        {            case '2':                echo 'Vous n\'avez pas de nouvelles alertes';            break;            case '3':                echo 'Vous n\'avez pas de nouveaux messages du jeu';            break;            case '4':                echo 'Vous n\'avez pas de nouveaux messages de votre guilde';            break;            case '5':                echo 'Vous n\'avez pas de nouveaux messages de vos amis';            break;        }        echo '</td></tr>';}}echo '</table>';echo '<div style="float:left;">';$url = "page.php?category=messagerie&action=show_box&do=del";$onclick = "HTTPPostCall('$url','box_messages_form','box_container');";echo '<input type="button" class="button" value="Supprimer" onclick="'.$onclick.'" style="margin-left:2px;" />';echo '</div>';// Gestion du triecho '<div style="float:left;margin-left:20px;">';    echo '<form id="choose_tri" method="post">';        echo '<input type="button" class="button" value="Trier par :" />';                $url = "page.php?category=messagerie&action=show_box";        $target = "box_container";        $onclick = "HTTPPostCall('$url','choosetri','$target');";                echo '<select name="tri" onchange="'.$onclick.'">';            echo '<option value="1" ';                if($_GET['tri'] == 1) echo ' selected=selected';            echo ' > Tous </option>';                        echo '<option value="2" ';                if($_GET['tri'] == 2) echo ' selected=selected';            echo ' > Alertes </option>';                        echo '<option value="3" ';                if($_GET['tri'] == 3) echo ' selected=selected';            echo ' > Arelidon </option>';                        echo '<option value="4" ';                if($_GET['tri'] == 4) echo ' selected=selected';            echo ' > Guilde </option>';            echo '<option value="5" ';                if($_GET['tri'] == 5) echo ' selected=selected';            echo ' > Amis </option>';        echo '</select>';    echo '</form>';echo '</div>';if($_GET['min'] >= 10){    $temp_min = $_GET['min'] - 10;    $temp_max = $_GET['max'] - 10;    $url = "page.php?category=messagerie&action=show_box&min".$temp_min."&max=".$temp_max."&tri=".$_GET['tri'];    $onclick = "HTTPTargetCall('$url','box_container');";	    echo '<div style="float:right;"><input type="button" class="button" value="Pr&eacute;c&eacute;dent" onclick="'.$onclick.'" /></div>';}$count = message::countMessageNoDelete($char);if($count >= (11 + $_GET['min'])){    $temp_min = $_GET['min'] + 10;    $temp_max = $_GET['max'] + 10;    $url = "page.php?category=messagerie&action=show_box&min".$temp_min."&max=".$temp_max."&tri=".$_GET['tri'];    $onclick = "HTTPTargetCall('$url','box_container');";	    echo '<div style="float:right;"><input type="button" class="button" value="Suivant" onclick="'.$onclick.'" /></div>';}echo '</form>';echo '</div>';echo '</div>';?>