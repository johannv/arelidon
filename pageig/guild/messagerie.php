<?phprequire_once($server.'/class/guild.class.php');$char = unserialize($_SESSION['char']);$guild = new guild($char->getGuildId());if(empty($_GET['do'])) $_GET['do'] = '';switch($_GET['do']){	case 'add':		$guild->addMessage($char,$_POST['message']);	break;	case 'delete':		$guild->deleteMessage($_GET['message_id']);	break;}echo '<div class="backgroundBodyNoRadius" style="margin:auto;width:550px;margin-top:15px;">';	echo '<div class="backgroundMenuNoRadius" style="padding-left:20px;">';		echo 'Ecrire un message sur le hall de la guilde';	echo '</div>';	echo '<div style="padding:5px;">';		$url = "page.php?category=guilde&mode=Messagerie&do=add";		echo '<form id="add_message" method="post">';			$onclick = "HTTPPostCall('$url','add_message','bodygameig');";			echo '<input name="message" type="text" size="65" /> <input value="Ecrire" type="button" class="button" onclick="'.$onclick.'"  />';		echo '</form>';	echo '</div>';echo '</div>';echo '<div class="backgroundBodyNoRadius" style="margin:auto;width:550px;margin-top:15px;">';	echo '<div class="backgroundMenuNoRadius" style="padding-left:20px;">';		echo 'Hall de guilde';	echo '</div>';	echo '<div style="padding:5px;height:450px;margin-bottom:10px;margin-top:10px;">';		$lastMessages = $guild->getLastMessage();		if(count($lastMessages)>= 1)		{			foreach($lastMessages as $message)			{				$author = char::getNameById($message['char_id']);				$hours = timestampToHour($message['timestamp'],'h');				$date = timestampToDate($message['timestamp'],'/');				echo '<div class="backgroundMenuNoRadius" style="z-index:1;font-weight:700;padding-left:15px;cursor:pointer;margin-top:10px;" onclick="show(\'message_text_'.$message['id'].'\');" >';						echo ' Message de '.$author.', Le '.$date.' &agrave; '.$hours;										// Possibilitï¿½ de supprimer un message (meneur)					if($char->isMeneur())					{						$url = "page.php?category=guilde&mode=Messagerie&do=delete&message_id=".$message['id'];						$onclick = "if(confirm('Supprimer ce message ?')){HTTPTargetCall('$url','bodygameig');}";						echo '<div style="float:right;margin-right:4px;z-index:3;">';							echo '<img style="z-index:36;" src="pictures/utils/no.gif" onclick="'.$onclick.'" alt="X" title="Supprimer ce message" />';						echo '</div>';					}				echo '</div>';				echo '<div id="message_text_'.$message['id'].'" style="padding-left:30px;padding-right:30px;padding-top:5px;display:none;">';					echo $message['message'];				echo '</div>';			}		}else{			echo '<div style="margin-top:20px;padding-left:15px;font-weight:700;">';				echo 'Pas de messages';			echo '</div>';		}	echo '</div>';echo '</div>';echo '<div style="height:15px;"></div>';?>