<?php require_once($server.'/class/pnj.class.php');require_once($server.'/class/guild.class.php');$pnj = new pnj($_GET['pnj']);$action = $_GET['action']; if($action == 'add'){	if($char->getGold() >= 250 && $char->getGuildId() == 0)	{		$name = $_POST['name'];		if(!guild::isFree($name))		{			$guild = new guild();			$guild->add($char->getId(),$name);			$char->loadChar($char->getId());			$price = -250;			$char->updateMore('gold',$price);			$guild->setTimeStamp();		}else{			$error = "le nom de guilde est d&eacute;j&agrave; pris";		}	}else{		$error = "Vous n'avez pas assez d'or pour cr&eacute;er une guilde";	}} if($action == 'join'){	if($char->getGold() >= 100 && $char->getGuildId() == 0)	{		$guild = new guild($_POST['guild_id']);		// Si on a pas atteint le nombre maximum de membre		if($guild->noFull())		{			$bug = $guild->createCandidature($char,$_POST['message']);			if($bug)			{				$error = "Un probl�me est survenu lors de l'envoi de la candidature";				}else{				$price = -100;				$char->updateMore('gold',$price);				}		}else{			$error = "la guilde comporte d&eacute;j&agrave; le nombre maximum de membres";		}	}else{		$error = "Vous n'avez pas assez d'or pour rejoindre une guilde";	}	}############################################################################################################################################// Affichage de l'image du personnageecho '<div>';	echo '<div style="float:left;">';		echo '<div id="face_container" style="height:120px;margin-left:30px;">';			echo '<div style="text-align:center;margin-top:15px;">';				echo '<img src="pictures/face/'.$pnj->getFace().'" style="border:solid 2px black;background:grey;" />';			echo '</div>';		echo '</div>';	echo '</div>';	// Le joueur a t'il une guilde ?	if($char->getGuildId() >= 1 )	{		echo '<div style="float:left;">';		$style_add = array('margin-top'=>'20px','height'=>'220px','align'=>'center','width'=>'580px','font-weight'=>'500');		switch($action)		{				case 'add':				if($error == '')				{					$txt = "ta guilde a bien &eacute;t&eacute; cr&eacute;e, si tu veux la g&egrave;rer va dans le menu \"guilde\" dans le menu en haut de la page";					$style_empty = array();					createTexte($txt,$style_empty,$style_add);				}				else{					$style_empty = array();					$error .= '<br />';					$url = "page.php?category=guild_pnj&pnj=".$pnj->id;					$onclick = "HTTPTargetCall('$url','bodygameig');cleanMenu();";						$error .= createButton('Retour',$onclick,'','','7',true);					createTexte($error,$style_empty,$style_add);				}			break;			case 'join':				if($error == '')				{					$txt = "ta candidature a bien &eacute;t&eacute; transmise au meneur de la guilde";					$style_empty = array();					createTexte($txt,$style_empty,$style_add);				}				else{					$style_empty = array();					$error .= '<br />';					$url = "page.php?category=guild_pnj&pnj=".$pnj->id;					$onclick = "HTTPTargetCall('$url','bodygameig');cleanMenu();";						$error .= createButton('Retour',$onclick,'','','7',true);					createTexte($error,$style_empty,$style_add);				}			break;			default:				// Vous avez déjà une guilde					$txt = "tu poss&egrave;des d&eacute;j&agrave; une guilde, pour g&eacute;rer ta guilde il suffit d'aller dans le menu guilde en haut de ta page";				$style_add = array('margin-top'=>'20px','height'=>'70px','align'=>'center','width'=>'580px','font-weight'=>'500');				$style_empty = array();				createTexte($txt,$style_empty,$style_add);			break;		}		echo '</div>';	}else{####################### AFFICHAGE DE LA PAGE (cadre de cr�ation + cadre pour rejoindre une guilde ) #######################################				// Création de guilde		echo '<div style="float:left;">';			$txt = '<div>';			$action = "page.php?category=guild_pnj&action=add";			$gold_string = getGoldPict(true);			$txt .= '<div style="float:left;border:solid 1px black;margin-left:20px;padding:7px">';				$txt .= '<div> <b><u>Cr&eacute;er votre Guilde</u></b></div>';				$txt .= '<form id="form_add_guild" method="POST" action="'.$action.'"><div style="margin-top:8px;">';					$txt .= '<div style="margin-top:5px;"> Nom de la guilde : <br /><input id="name" type="text" name="name" size="25" /></div>';					$txt .= '<div style="margin-top:5px;"> Prix de la cr&eacute;ation : 250 '.$gold_string.'</div>';					$txt .= '<div style="text-align:center;margin-top:10px;"><input type="button" onclick="addGuild('.$pnj->getId().');" class="button" value="Cr&eacute;er la guilde" /></div></form>';				$txt .= '</div>';			$txt .= '</div>';		// Rejoindre une guilde				$action = "page.php?category=guild_pnj&action=add";			$txt .= '<div style="float:left;border:solid 1px black;margin-left:20px;padding:7px">';				$txt .= '<div> <b><u>Rejoindre une Guilde de votre faction</u></b></div>';				$txt .= '<form id="form_join_guild" method="POST" action="'.$action.'"><div style="margin-top:8px;">';					$allGuilds = guild::getAllGuild($char->getFaction());					$txt .= '<select name="guild_id">';						foreach($allGuilds as $guild)							$txt .= '<option value="'.$guild['id'].'">'.$guild['name'].'</option>';					$txt .= '</select><br />';					$txt .= '<textarea name="message" row="3" style="margin-top:3px;">';						$txt .= ' Salutation, ';					$txt .= '</textarea>';					$txt .= '<div style="margin-top:5px;"> Prix d\'entr&eacute;e : 100 '.$gold_string.'</div>';					$txt .= '<div style="text-align:center;margin-top:10px;"><input type="button" onclick="joinGuild('.$pnj->getId().');" class="button" value="Rejoindre la Guilde" /></div></form>';				$txt .= '</div>';			$txt .= '</div>';			$txt .= '</div>';			$txt .= '<div style="margin-top:200px;margin-left:150px;"> Votre bourse : '.$char->getGold().' '.$gold_string.'</div>';			$style_add = array('margin-top'=>'20px','height'=>'220px','align'=>'center','width'=>'580px','font-weight'=>'500');			$style_empty = array();			createTexte($txt,$style_empty,$style_add);		echo '</div>';	}echo '</div>';// Bouton sortir echo '<div>';	$link = "ingame.php";	createButton('Sortir',"",'exit',$link);echo '</div>'; ?>